{% extends 'acoes/base.html' %}
{% load static %}

{% block title %}Gerenciar Inscrições - {{ acao.titulo }}{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/acoes.css' %}">
{% endblock %}

{% block content %}
    <div class="page-header">
        <div>
            <h1 class="action-title m-0">Gerenciar Inscrições</h1>
            <p class="page-subtitle">{{ acao.titulo }}</p>
        </div>
        <a href="{{ acao.get_absolute_url }}" class="btn btn-muted">
            &larr; Voltar para Ação
        </a>
    </div>

    <div class="vacancy-banner {% if acao.esta_cheia %}full{% endif %}">
        <div class="vacancy-info">
            <span class="vacancy-label">Ocupação de Vagas</span>
            <div class="vacancy-numbers">
                <strong>{{ acao.vagas_preenchidas }}</strong> / {{ acao.numero_vagas }}
            </div>
        </div>
        <div class="vacancy-status">
            {% if acao.esta_cheia %}
                <span class="badge badge-danger">Lotação Esgotada</span>
            {% else %}
                <span class="badge badge-category">Vagas Disponíveis</span>
            {% endif %}
        </div>
    </div>

    <section class="manage-section">
        <h2 class="section-title">
            Solicitações Pendentes 
            {% if pendentes %}
                <span class="badge badge-info" style="margin-left: 0.5rem; font-size: 0.8rem;">{{ pendentes.count }}</span>
            {% endif %}
        </h2>
        
        <div class="card-panel">
            {% if not pendentes %}
                <div class="empty-state-mini">
                    <p>Nenhuma solicitação pendente no momento.</p>
                </div>
            {% else %}
                <div class="pending-list">
                    {% for inscricao in pendentes %}
                        <div class="pending-item">
                            <div class="pending-info">
                                <strong class="user-name">{{ inscricao.voluntario.username }}</strong>
                                <span class="user-date">Solicitado em {{ inscricao.data_inscricao|date:"d/m/Y" }}</span>
                            </div>
                            
                            <div class="pending-actions">
                                <form action="{% url 'acoes:acao_manage' acao.pk %}" method="POST">
                                    {% csrf_token %}
                                    <input type="hidden" name="inscricao_id" value="{{ inscricao.id }}">
                                    <input type="hidden" name="status" value="ACEITO">
                                    
                                    <button type="submit" class="btn btn-primary btn-sm" 
                                        {% if acao.esta_cheia %}disabled title="Sem vagas"{% endif %}>
                                        Aceitar
                                    </button>
                                </form>

                                <form action="{% url 'acoes:acao_manage' acao.pk %}" method="POST">
                                    {% csrf_token %}
                                    <input type="hidden" name="inscricao_id" value="{{ inscricao.id }}">
                                    <input type="hidden" name="status" value="REJEITADO">
                                    <button type="submit" class="btn btn-danger btn-sm">
                                        Rejeitar
                                    </button>
                                </form>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    </section>

    <div class="manage-grid">
        
        <div class="manage-column">
            <h2 class="section-title text-success">Voluntários Aceitos ({{ aceitas.count }})</h2>
            <div class="card-panel">
                <ul class="user-list">
                    {% for inscricao in aceitas %}
                        <li class="user-list-item">
                            <span class="username">{{ inscricao.voluntario.username }}</span>
                            
                            {% if not acao.ja_aconteceu %}
                                <form action="{% url 'acoes:acao_manage' acao.pk %}" method="POST" onsubmit="return confirm('Tem certeza que deseja remover este voluntário?');">
                                    {% csrf_token %}
                                    <input type="hidden" name="inscricao_id" value="{{ inscricao.id }}">
                                    <input type="hidden" name="status" value="REMOVIDO"> 
                                    <button type="submit" class="btn-link-danger">Remover</button>
                                </form>
                            {% endif %}
                        </li>
                    {% empty %}
                        <li class="empty-list-item">Nenhum voluntário aceito.</li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <div class="manage-column">
            <h2 class="section-title text-danger">Rejeitados/Cancelados ({{ rejeitadas.count }})</h2>
            <div class="card-panel">
                <ul class="user-list">
                    {% for inscricao in rejeitadas %}
                        <li class="user-list-item rejected">
                            <span class="username">{{ inscricao.voluntario.username }}</span>
                            <span class="badge badge-neutral">Recusado</span>
                        </li>
                    {% empty %}
                        <li class="empty-list-item">Nenhum registro.</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
{% endblock %}