{% extends 'acoes/base.html' %}

{% block title %}Gerenciar Inscrições - {{ acao.titulo }}{% endblock %}

{% block content %}
    <div class="flex justify-between items-center mb-6">
        <div>
            <h1 class="text-3xl font-bold text-gray-800">Gerenciar Inscrições</h1>
            <p class="text-xl text-gray-600">{{ acao.titulo }}</p>
        </div>
        <a href="{{ acao.get_absolute_url }}" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold rounded-lg transition duration-300">
            Voltar para Ação
        </a>
    </div>

    <!-- Vagas -->
    <div class="bg-blue-100 text-blue-800 p-4 rounded-lg mb-6">
        <h2 class="font-bold text-lg">
            Vagas: {{ acao.vagas_preenchidas }} / {{ acao.numero_vagas }}
            {% if acao.esta_cheia %}(Vagas Preenchidas){% endif %}
        </h2>
    </div>

    <!-- Solicitações Pendentes -->
    <div class="bg-white rounded-lg shadow-xl p-6 mb-8">
        <h2 class="text-2xl font-semibold text-gray-800 mb-4">Solicitações Pendentes ({{ pendentes.count }})</h2>
        
        {% if not pendentes %}
            <p class="text-gray-600">Nenhuma solicitação pendente no momento.</p>
        {% endif %}

        <ul class="space-y-4">
            {% for inscricao in pendentes %}
                <li class="flex flex-wrap justify-between items-center p-4 border rounded-md">
                    <div>
                        <strong class="text-lg">{{ inscricao.voluntario.username }}</strong>
                        <span class="text-sm text-gray-500"> (em <span class="item-date">{{ inscricao.data_inscricao|date:"d/m/Y" }}</span>)</span>
                    </div>
                    <!-- Formulários de Ação -->
                    <div class="flex gap-2 mt-2 md:mt-0">
                        <!-- Botão Aceitar -->
                        <form action="{% url 'acoes:acao_manage' acao.pk %}" method="POST" class="inline">
                            {% csrf_token %}
                            <input type="hidden" name="inscricao_id" value="{{ inscricao.id }}">
                            <input type="hidden" name="status" value="ACEITO">
                            <button type="submit" 
                                    class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white text-sm font-medium rounded-md transition duration-300
                                    {% if acao.esta_cheia %} opacity-50 cursor-not-allowed {% endif %}"
                                    {% if acao.esta_cheia %} disabled {% endif %}>
                                Aceitar
                            </button>
                        </form>
                        <!-- Botão Rejeitar -->
                        <form action="{% url 'acoes:acao_manage' acao.pk %}" method="POST" class="inline">
                            {% csrf_token %}
                            <input type="hidden" name="inscricao_id" value="{{ inscricao.id }}">
                            <input type="hidden" name="status" value="REJEITADO">
                            <button type="submit" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white text-sm font-medium rounded-md transition duration-300">
                                Rejeitar
                            </button>
                        </form>
                    </div>
                </li>
            {% endfor %}
        </ul>
    </div>

    <!-- Listas de Aceitos e Rejeitados -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Voluntários Aceitos -->
        <div class="bg-white rounded-lg shadow-xl p-6">
            <h2 class="text-2xl font-semibold text-green-700 mb-4">Voluntários Aceitos ({{ aceitas.count }})</h2>
            <ul class="space-y-2">
                {% for inscricao in aceitas %}
                    <li class="text-gray-700">{{ inscricao.voluntario.username }}</li>
                {% empty %}
                    <li class="text-gray-500">Nenhum voluntário aceito.</li>
                {% endfor %}
            </ul>
        </div>

        <!-- Solicitações Rejeitadas -->
        <div class="bg-white rounded-lg shadow-xl p-6">
            <h2 class="text-2xl font-semibold text-red-700 mb-4">Rejeitados ({{ rejeitadas.count }})</h2>
            <ul class="space-y-2">
                {% for inscricao in rejeitadas %}
                    <li class="text-gray-500 line-through">{{ inscricao.voluntario.username }}</li>
                {% empty %}
                    <li class="text-gray-500">Nenhuma solicitação rejeitada.</li>
                {% endfor %}
            </ul>
        </div>
    </div>
{% endblock %}