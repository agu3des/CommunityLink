{% extends 'acoes/base.html' %}
{% load static %}

{% block title %}{{ acao.titulo }} - CommunityLink{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/acoes.css' %}">
{% endblock %}

{% block content %}
<div class="detail-container">
    
    <article class="detail-card">
        <header class="detail-header">
            <div class="detail-badges">
                <span class="badge badge-category">{{ acao.get_categoria_display }}</span>
                {% if acao.ja_aconteceu %}
                    <span class="badge badge-neutral">Concluída</span>
                {% elif acao.esta_cheia %}
                    <span class="badge badge-danger">Lotação Esgotada</span>
                {% else %}
                    <span class="badge badge-info">Aberta</span>
                {% endif %}
            </div>
            <h1 class="detail-title">{{ acao.titulo }}</h1>
        </header>

        <div class="detail-info-grid">
            
            <div class="info-box">
                <div class="info-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                </div>
                <div class="info-content">
                    <span class="info-label">Data e Hora</span>
                    <span class="info-value">{{ acao.data|date:"d/m/Y \à\s H:i" }}</span>
                </div>
            </div>

            <div class="info-box">
                <div class="info-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                </div>
                <div class="info-content">
                    <span class="info-label">Local</span>
                    <span class="info-value">{{ acao.local }}</span>
                </div>
            </div>

            <div class="info-box">
                <div class="info-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                </div>
                <div class="info-content">
                    <span class="info-label">Organizador</span>
                    <span class="info-value">{{ acao.organizador.username }}</span>
                </div>
            </div>

            <div class="info-box">
                <div class="info-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                </div>
                <div class="info-content">
                    <span class="info-label">Vagas Preenchidas</span>
                    <span class="info-value">
                        <strong>{{ acao.vagas_preenchidas }}</strong> / {{ acao.numero_vagas }}
                    </span>
                    <div class="progress-bar-bg">
                        <div class="progress-bar-fill" style="width: { % widthratio acao.vagas_preenchidas acao.numero_vagas 100 % } %;"></div>
                    </div>
                </div>
            </div>

        </div>

        <div class="detail-description">
            <h2>Sobre a Ação</h2>
            <div class="prose-content">
                {{ acao.descricao|linebreaks }}
            </div>
        </div>

        <footer class="detail-actions">
            {% if user.is_authenticated %}
                {% if is_owner %}
                    <div class="owner-actions">
                        {% if not acao.ja_aconteceu %}
                            <a href="{% url 'acoes:acao_update' acao.pk %}" class="btn btn-muted">Editar</a>
                            <a href="{% url 'acoes:acao_delete' acao.pk %}" class="btn btn-danger-outline">Excluir</a>
                        {% else %}
                            <span class="status-message locked">Ação Concluída (Edição bloqueada)</span>
                        {% endif %}
                        
                        <a href="{% url 'acoes:acao_manage' acao.pk %}" class="btn btn-muted">Gerenciar Inscrições</a>
                    </div>
                {% else %}
                    {% if ja_inscrito %}
                        <div class="volunteer-status">
                            <span class="btn btn-disabled">Status: {{ inscricao_status }}</span>
                            {% if inscricao_status == 'PENDENTE' %}
                                <p class="help-text">Aguardando aprovação do organizador.</p>
                            {% endif %}
                        </div>
                    {% elif acao.esta_cheia %}
                        <button class="btn btn-disabled w-full" disabled>Vagas Esgotadas</button>
                    {% else %}
                        <form action="{% url 'acoes:acao_apply' acao.pk %}" method="POST" class="apply-form">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-primary btn-lg w-full">Quero me Voluntariar!</button>
                        </form>
                    {% endif %}
                {% endif %}
            {% else %}
                <a href="/acoes/signin/?next={{ request.path }}" class="btn btn-primary w-full">Faça login para se voluntariar</a>
            {% endif %}
        </footer>

    </article>
</div>
{% endblock %}