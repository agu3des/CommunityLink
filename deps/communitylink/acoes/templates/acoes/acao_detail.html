{% extends 'acoes/base.html' %}

{% block title %}{{ acao.titulo }} - CommunityLink{% endblock %}

{% block content %}
<div class="card card-acao" style="max-width:900px; margin:0 auto;">
    <!-- Título e Categoria -->
    <div style="margin-bottom:0.2rem;">
        <span class="badge">{{ acao.get_categoria_display }}</span>
    </div>
    <h1 class="card-title">{{ acao.titulo }}</h1>

    <!-- Informações Principais -->
    <div class="grid-list" style="margin-top:0.2rem;">
        <div class="grid-item half"><p class="muted"><strong>Data:</strong> <span class="item-date">{{ acao.data|date:"d/m/Y \\\à\\\s H:i" }}</span></p></div>
        <div class="grid-item half"><p class="muted"><strong>Local:</strong> <span class="location">{{ acao.local }}</span></p></div>
        <div class="grid-item half"><p class="muted"><strong>Organizador:</strong> {{ acao.organizador.username }}</p></div>
        <div class="grid-item half"><p class="muted"><strong>Vagas Preenchidas:</strong>
            <span class="muted">{{ acao.vagas_preenchidas }} / {{ acao.numero_vagas }} {% if acao.esta_cheia %}(Esgotado){% else %}(Há vagas){% endif %}</span>
        </p></div>
    </div>

    <!-- Descrição -->
    <div class="prose" style="margin-top:1rem;">
        <h2 style="margin:0 0 0.2rem 0;">Descrição da Ação</h2>
        <p>{{ acao.descricao|linebreaks }}</p>
    </div>

    <!-- Botões de Ação -->
    <div style="border-top:1px solid rgba(15,23,42,0.04); padding-top:1rem; margin-top:1rem; display:flex; gap:0.75rem; flex-wrap:wrap;">
        {% if user.is_authenticated %}
            {% if is_owner %}
                {% if not acao.ja_aconteceu %}
                    <a href="{% url 'acoes:acao_update' acao.pk %}" class="btn btn-muted">Editar Ação</a>
                    <a href="{% url 'acoes:acao_delete' acao.pk %}" class="btn btn-danger">Deletar Ação</a>
                {% else %}
                    <span class="py-2 px-4 bg-gray-100 text-gray-500 rounded border border-gray-300 cursor-not-allowed">
                        Ação Concluída (Edição bloqueada)
                    </span>
                {% endif %}
                
                <a href="{% url 'acoes:acao_manage' acao.pk %}" class="btn btn-muted">Gerenciar Inscrições</a>
            {% else %}
                {% if ja_inscrito %}
                    <span class="btn btn-muted">Solicitação Enviada (Status: {{ inscricao_status }})</span>
                {% elif acao.esta_cheia %}
                    <span class="btn btn-muted">Vagas Esgotadas</span>
                {% else %}
                    <form action="{% url 'acoes:acao_apply' acao.pk %}" method="POST" style="display:inline-block; margin:0;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-primary">Quero me Voluntariar!</button>
                    </form>
                {% endif %}
            {% endif %}
        {% else %}
            <a href="/acoes/signin/?next={{ request.path }}" class="btn btn-primary">Faça login para se voluntariar</a>
        {% endif %}
    </div>

</div>
{% endblock %}